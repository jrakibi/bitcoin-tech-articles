---
title: 'P2PK (Pay To Public Key)'
date: 2024-07-05T15:32:14Z
lastmod: '2024-07-06'
tags: ['bitcoin', 'privacy']
draft: false
summary: 'AThis article discusses the Pay To Public Key (P2PK) method used in Bitcoin transactions, highlighting its role in enhancing user privacy and security. Includes practical code examples and deep insights into its operation within the Bitcoin protocol.'
layout: PostSimple
---

Pay to Public Key (P2PK) is one of the simplest forms of Bitcoin scripts.  
It allows bitcoins to be sent directly to a public key.  
The recipient must provide a valid signature to spend them.

> [!NOTE]
> Despite being the simplest script for locking bitcoins to someone's public key, P2PK is not used as much as P2PKH.

## How does it work:

The ability to lock and unlock coins is the mechanism by which we transfer bitcoin.  
*Locking* is giving bitcoins to someone.  
*Unlocking* is spending bitcoins that you have received.

<SvgDisplay src="/script-visualizer/lock_unlock2.svg" width="70%" height="auto" />

Let's take Alice and Bob to help us understand this better:
Alice want to send some bitcoins to Bob.

#### 1- Locking (ScriptPubKey):

When creating a P2PK transaction, Alice specifies Bob's #public key in the ScriptPubKey.  
**ScriptPubKey**: A P2PK locking script looks like this:

```
<Public key Bob> OP_CHECKSIG
```

This script specifies the conditions that must be met to spend the bitcoins in the future.
and it's Placed within the output of a transaction.

#### 2- Unlocking (ScriptSig)

To spend Bitcoin that Alice sent, Bob must provide a valid signature corresponding to the public key.  
**ScriptSig:** P2PK Unlocking script looks like this:

```
<Signature Bob>
```

#### 3- Validation

When a transaction is validated, the ScriptSig and ScriptPubKey are concatenated.

```
<signature Bob> <public key Bob> OP_CHECKSIG
```

> [!NOTE]
> OP_CHECKSIG is an opcode that verifies ECDSA signature. It takes two inputs from the stack (public key + signature) and push TRUE (OP_1) to the stack if the check passed, FALSE (OP_0) otherwise.

## Script Validation:

The combined script is executed using stack operations.

Let’s break down how it works using this animation:

<ScriptStackVisualizer type="p2pk"></ScriptStackVisualizer>

<ExpandableSection
  title="Element VS Operation (Optional)"
  preview="In the previous example, Signature and Public Key are elements, while OP_CHECKSIG is an operation. To understand the difference between an Element and an Operation, read this."
>
### Elements

- **Definition:** Data pushed onto the stack.
- **Type:** Byte strings (1 to 520 bytes).
- **Example:** Signatures or public keys.

### Operations

- **Definition:** Commands that manipulate stack elements.
- **Type:** Consume and push elements.
- **Example:** `OP_DUP`, `OP_HASH160`, `OP_CHECKSIG`.

### Example: OP_CHECKSIG

1. **OP_CHECKSIG**
   - **Function:** Verifies the ECDSA signature.
   - **Stack Operation:** Consumes 2 elements (pubkey and signature) and pushes 1 element (1 (TRUE) if valid, 0 (FALSE) if not).

### Summary Table

| Type          | Description                      | Example       | Consumption | Push            |
| ------------- | -------------------------------- | ------------- | ----------- | --------------- |
| **Element**   | Data for the stack               | DER Signature | N/A         | N/A             |
| **Operation** | Duplicates the top stack element | OP_DUP        | 0 elements  | 1 element       |
| **Operation** | Hashes the top stack element     | OP_HASH160    | 1 element   | 1 element       |
| **Operation** | Verifies a signature             | OP_CHECKSIG   | 2 elements  | 1 element (0/1) |

</ExpandableSection>

### First Bitcoin transaction in history

One notable P2PK transaction is from block 170, which includes a payment from Satoshi Nakamoto to Hal Finney.

- **Transaction ID**: [f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16](https://mempool.space/tx/f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16)

<TransactionsDisplay></TransactionsDisplay>

> **Note:** You can Hover over and click on transaction fields to see more details.

## P2PK Limitations and why we need P2PKH ?

#### Problems with P2PK

- ❌ Public keys are long (33 or 65 bytes).
- ❌ This results in a larger UTXO set because these keys must be stored and indexed, requiring more resources for full nodes.
- ❌ Pblic keys are visible on the bitcoin network, posing a risk if ECDSA is ever broken.

#### Solutions with P2PKH

P2PKH (Pay to Public Key Hash) addresses these challenges by using a hashed version of the public key. This creates:

- ✅ Shorter, more manageable addresses by using SHA-256 and RIPEMD-160 to produce a 20-byte hash.
- ✅ Improve security by hiding the public key, providing additional protection against future attacks on ECDSA.

| Aspect             | P2PK                                   | P2PKH                                        |
| ------------------ | -------------------------------------- | -------------------------------------------- |
| **Address Length** | 33 or 65 bytes (66 or 130 characters)  | 20 bytes (40 characters)                     |
| **UTXO Set Size**  | Larger due to storing full public keys | Smaller due to storing hashes                |
| **Privacy**        | Public keys are visible                | Public keys are hashed, enhancing privacy    |
| **Security**       | Vulnerable if ECDSA is broken          | Additional layer of security through hashing |

#### Example Address Comparison

| Format    | Example Length                    |
| --------- | --------------------------------- |
| **P2PK**  | 130 characters (uncompressed SEC) |
| **P2PKH** | 40 characters (hash160)           |

### Exercise:

> [!WARNING] > **Note:** THIS EXERCISE IS NOT COMPLETE. (IGNORE THIS)

Create a ScriptSig that can unlock this ScriptPubKey. Make this ....

{' '}

<CodeEditor
  src="https://codesandbox.io/p/devbox/p2pkh-lvfxrl?embed=1&file=%2Fmain.py"
  title="P2PKH Code Example"
/>
---{' '}

> [!IMPORTANT] > **Next Topic:** In the next topic, we'll dive deeper into the specifics of
> P2PKH.
